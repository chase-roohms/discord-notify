---
name: Test Input Validation

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  test-missing-webhook:
    name: Test - Missing webhook_url
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Missing webhook_url
        id: test
        continue-on-error: true
        uses: ./
        with:
          content: "Test message"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Missing webhook_url should have failed validation"
          exit 1
  
  test-invalid-webhook:
    name: Test - Invalid webhook URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid webhook URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://example.com/not-a-webhook"
          content: "Test message"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid webhook_url should have failed validation"
          exit 1
  
  test-invalid-avatar:
    name: Test - Invalid avatar URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid avatar URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          content: "Test message"
          avatar_url: "not-a-url"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid avatar_url should have failed validation"
          exit 1
  
  test-no-content:
    name: Test - No content provided
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - No content provided
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: No content/embeds should have failed validation"
          exit 1
  
  test-too-many-embeds:
    name: Test - Too many embeds
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Too many embeds
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: '["E1", "E2", "E3", "E4", "E5", "E6", "E7", "E8", "E9", "E10", "E11"]'
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: More than 10 embeds should have failed validation"
          exit 1
  
  test-invalid-color:
    name: Test - Invalid embed color
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed color
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-colors: "GGGGGG"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid hex color should have failed validation"
          exit 1
  
  test-invalid-embed-url:
    name: Test - Invalid embed URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-urls: "not-a-valid-url"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-urls should have failed validation"
          exit 1
  
  test-invalid-image-url:
    name: Test - Invalid embed image URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed image URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-image-urls: "ftp://not-http-url.com/image.png"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-image-urls should have failed validation"
          exit 1
  
  test-invalid-thumbnail:
    name: Test - Invalid embed thumbnail URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed thumbnail URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-thumbnail-urls: "invalid-url"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-thumbnail-urls should have failed validation"
          exit 1
  
  test-invalid-author-url:
    name: Test - Invalid embed author URL
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed author URL
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-authors: "Author Name"
          embed-author-urls: "not-a-url"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-author-urls should have failed validation"
          exit 1
  
  test-invalid-author-icon:
    name: Test - Invalid embed author icon
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed author icon
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-authors: "Author Name"
          embed-author-icons: "invalid"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-author-icons should have failed validation"
          exit 1
  
  test-invalid-footer-icon:
    name: Test - Invalid embed footer icon
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed footer icon
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-footers: "Footer Text"
          embed-footer-icons: "invalid"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-footer-icons should have failed validation"
          exit 1
  
  test-invalid-timestamp:
    name: Test - Invalid embed timestamp
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed timestamp
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-timestamps: "not-a-valid-timestamp"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-timestamps should have failed validation"
          exit 1
  
  test-invalid-fields-json:
    name: Test - Invalid embed fields JSON
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid embed fields JSON
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-fields: "not valid json"
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid embed-fields JSON should have failed validation"
          exit 1
  
  test-fields-missing-props:
    name: Test - Embed fields missing properties
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Embed fields missing name/value
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: "Test Embed"
          embed-fields: '[{"name": "Field Name"}]'
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: embed-fields missing required properties should have failed"
          exit 1
  
  test-mismatched-arrays:
    name: Test - Mismatched array lengths
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Mismatched array lengths
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: '["Title 1", "Title 2"]'
          embed-colors: '["FF0000", "00FF00", "0000FF"]'
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Mismatched array lengths should have failed validation"
          exit 1
  
  test-invalid-color-array:
    name: Test - Invalid colors in array
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test - Invalid colors in array
        id: test
        continue-on-error: true
        uses: ./
        with:
          webhook_url: "https://discord.com/api/webhooks/123456789/abcdefghijk"
          embed-titles: '["Title 1", "Title 2"]'
          embed-colors: '["FF0000", "ZZZZZZ"]'
      
      - name: Verify test failed as expected
        if: steps.test.outcome != 'failure'
        run: |
          echo "❌ Test failed: Invalid color in array should have failed validation"
          exit 1
